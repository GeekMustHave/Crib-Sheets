= Crib Sheets
John Schuster <John.schuster@PhoenixWorkgroup.com>
v2.1b, 02/06/2020: Crib Sheet
:Author: John HR Schuster
:Company: Phoenix Workgroup Computing LLC
:toc: left
:toclevels: 4:
:title-page:
:title-logo-image: ./images/create-doco_gmh-blogArticle-cover.png
:imagesdir: ./images
:pagenums:
:numbered: 
:chapter-label: 
:experimental:
:source-hightlighter: pygments
:source-language: vbscript
:pygments-style: manni
:pygments-linenums-mode: inline
:icons: font
:docdir: ./documents
:github: https://github.com/GeekMustHave/GitHub repositoryName
:web-ste: https://OpenStuff.pwc-lms.com/doco/folder name
:linkattrs:
:seclinks:
:description: Metatag description \
more description
:author: John HR Schuster
:keywords: GeekMustHave, keyword2, keyword3
:email: GeekMustHave@PhoenixWorkgroup.com

These are crib notes.  Every time I look something up more than once I try to add it to this document.  Something simple.

The PDF version of this document is available at this link:./ReadMe.pdf[ Link]



== MSAccess

=== Substring (MID)

The Microsoft Access Mid function extracts a substring from a string (starting at any position).

----
Mid ( text, start_position, [number_of_characters] )
----

link:https://www.techonthenet.com/access/functions/string/mid.php[https://www.techonthenet.com/access/functions/string/mid.php, window='_blank']

=== Date Difference (DateDif)

The DateDiff() function returns the difference between two dates.

.DateDiff
[source,javascript]
----
DateDiff(datepart, date1, date2, firstdayofweek, firstweekofyear)

'*--- Return the difference between two dates, in years:
SELECT DateDiff("yyyy", #13/01/1998#, #09/05/2017#);
----

|===
|Parameter	|Description
|datepart	|Required. The part to return. Can be one of the following values:

* yyyy = Year
. q = Quarter
. m = month
. y = Day of the year
. d = Day
. w = Weekday
. ww = Week
. h = hour
. n = Minute
. s = Second
|===
date1 and date2	Required. The two dates to calculate the difference between
firstdayofweek	Optional. Specifies the first day of the week. Can be one of the following values:
0 = Use the NLS API setting
1 = Sunday (this is default)
2 = Monday
3 = Tuesday
4 = Wednesday
5 = Thursday
6 = Friday
7 = Saturday
firstdayofyear	Optional. Specifies the first week of the year. Can be one of the following values:
0 = Use the NLS API setting
1 = Use the first week that includes Jan 1st (default)
2 = Use the first week in the year that has at least 4 days
3 = Use the first full week of the year

link:https://www.w3schools.com/sql/func_msaccess_datediff.asp[https://www.w3schools.com/sql/func_msaccess_datediff.asp, window='_blank']

|===
|Format	|Explanation
|General Date	|Displays date based on your system settings
Long Date	Displays date based on your system's long date setting
Medium Date	Displays date based on your system's medium date setting
Short Date	Displays date based on your system's short date setting
Long Time	Displays time based on your system's long time setting
Medium Time	Displays time based on your system's medium time setting
Short Time	Displays time based on your system's short time setting

link:https://www.techonthenet.com/access/functions/date/format.php[https://www.techonthenet.com/access/functions/date/format.php, window='_blank']
|===


=== Format values

The Format function does exactly the same thing as formatting a number or a date within a cell in a spreadsheet, 
except it does so from within the code itself. If you wish to display a number in a message box or on a user form, 
this function is very useful for making it readable, particularly if it is a large number

.Examples
----
Format(1234567.89, "#,###.#")

format(([On_Hand]-[Qty_Needed]), "#,##0[Black];(#,##0)[Red];0;0")

sReturn = Format(sValueIS, "$###,###,###,##0[Black];($###,###,###,##0)[Red];;")
----
.Predefined Formats
[cols="2,8", options='header']
|===
|Format Name	|Description
|General Number	|Display the number as is.
|Currency	|Display the number with currency symbol. Use thousand separator. 
Enclose in brackets if negative. Display to two decimal places.
|Fixed	|Display at least one digit to the left and two digits to the right of the decimal point.
|Standard	|Display number with thousand separator. Display to two decimal places.
|Percent	|Display number multiplied by 100 with a percent sign (%) appended after. Display to two decimal places.
|Scientific	|Use standard scientific notation.
|Yes/No	|Display No if number is 0; otherwise, display Yes.
|True/False	|Display False if number is 0; otherwise, display True.
|On/Off	|Display Off if number is 0; otherwise, display On.
|===

A number of characters can be used to define a user-defined format, as shown below.
The format string can have up to four sections separated by semicolons (;). 
This is so different formats can be applied to different values, such as to positive and negative numbers. 
For example, you may wish to show brackets/parentheses around a negative value


.Section Detail
[cols="2,8", options='header']
|===
|Number of Sections | Formatting
|One section only	|Applies to all values
|Two sections	|First section for positive values, second section for negative values
|Three sections	|First section for positive values, second section for negative values, third section for zeros
|Four sections	|First section for positive values, second section for negative values, third section for zeros, fourth section for null values
|=== 

.User-Defined Formats
[cols="2,8", options='header']
|===
|Character	|Description
|Null String	|No formatting.
|0	|Digit placeholder. Displays a digit or a zero. If there is a digit for that position, then it displays the digit; otherwise, it displays 0. If there are fewer digits than zeros, you will get leading or trailing zeros. If there are more digits after the decimal point than there are zeros, then the number is rounded to the number of decimal places shown by the zeros. If there are more digits before the decimal point than zeros, these will be displayed normally.
|#	|Digit placeholder. This displays a digit or nothing. It works the same as the preceding zero placeholder, except that leading and trailing zeros are not displayed. For example, 0.75 would be displayed using zero placeholders, but this would be .75 using # placeholders.
|.Decimal point.	|Only one permitted per format string. This character depends on the settings in the Windows Control Panel.
|%	|Percentage placeholder. Multiplies number by 100 and places % character where it appears in the format string.
|,	|Thousand separator. This is used if 0 or # placeholders are used and the format string contains a comma. One comma to the left of the decimal point means to round to the nearest thousand (e.g., 0,). Two adjacent commas to the left of the thousand separator indicate rounding to the nearest million (e.g., 0,,).

|E- E+	|Scientific format. This displays the number exponentially.
|:	|Time separator-used when formatting a time to split hours, minutes, and seconds.
|/	|Date separator-this is used when specifying a format for a date.
|- +  $ ( )	|Displays a literal character. To display a character other than listed here, precede it with a backslash (\).
|===


.Predefined Date and Time Formats
[cols="2,5", options='header']
|===
|Format Name	|Description
|General Date	|Display a date and/or time. For real numbers, display date and time. 
Integer numbers display time only. If there is no integer part, then display only time.
|Long Date	|Displays a long date as defined in the international settings of the Windows Control Panel.
|Medium Date	|Displays a date as defined in the short date settings of the Windows Control Panel, except it spells out the month abbreviation.
|Short Date	|Displays a short date as defined in the International settings of the Windows Control Panel.
|Long Time	|Displays a long time as defined in the International settings of the Windows Control Panel.
|Medium Time	|Displays time in a 12-hour format using hours, minutes, and seconds and the AM/PM format.
|Short Time	|Displays a time using 24-hour format (e.g., 18:10).
|===

link:https://sourcedaddy.com/ms-access/format-function.html[https://sourcedaddy.com/ms-access/format-function.html, window='_blank']

=== Check if folder or file exists

.Access detect file
[source,vbscript,linenums]
----
Function FileExists(ByVal strFile As String, Optional bFindFolders As Boolean) As Boolean
    'Purpose:   Return True if the file exists, even if it is hidden.
    'Arguments: strFile: File name to look for. Current directory searched if no path included.
    '           bFindFolders. If strFile is a folder, FileExists() returns False unless this argument is True.
    'Note:      Does not look inside subdirectories for the file.
    'Author:    Allen Browne. http://allenbrowne.com June, 2006.
    Dim lngAttributes As Long

    'Include read-only files, hidden files, system files.
    lngAttributes = (vbReadOnly Or vbHidden Or vbSystem)

    If bFindFolders Then
        lngAttributes = (lngAttributes Or vbDirectory) 'Include folders as well.
    Else
        'Strip any trailing slash, so Dir does not look inside the folder.
        Do While Right$(strFile, 1) = "\"
            strFile = Left$(strFile, Len(strFile) - 1)
        Loop
    End If

    'If Dir() returns something, the file exists.
    On Error Resume Next
    FileExists = (Len(Dir(strFile, lngAttributes)) > 0)
End Function

Function FolderExists(strPath As String) As Boolean
    On Error Resume Next
    FolderExists = ((GetAttr(strPath) And vbDirectory) = vbDirectory)
End Function

Function TrailingSlash(varIn As Variant) As String
    If Len(varIn) > 0 Then
        If Right(varIn, 1) = "\" Then
            TrailingSlash = varIn
        Else
            TrailingSlash = varIn & "\"
        End If
    End If
End Function
----

=== Copy file

.Access Copy File
[source,javascript]
----
'---------------------------------------------------------------------------------------
' Procedure : CopyFile
' Author    : Daniel Pineault, CARDA Consultants Inc.
' Website   : http://www.cardaconsultants.com
' Purpose   : Copy a file
'             Overwrites existing copy without prompting
'             Cannot copy locked files (currently in use)
' Copyright : The following is release as Attribution-ShareAlike 4.0 International
'             (CC BY-SA 4.0) - https://creativecommons.org/licenses/by-sa/4.0/
' Req'd Refs: None required
'
' Input Variables:
' ~~~~~~~~~~~~~~~~
' sSource - Path/Name of the file to be copied
' sDest - Path/Name for copying the file to
'
' Revision History:
' Rev       Date(yyyy/mm/dd)        Description
' ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
' 1         2007-Apr-01             Initial Release
'---------------------------------------------------------------------------------------
Public Function CopyFile(sSource As String, sDest As String) As Boolean
On Error GoTo CopyFile_Error
 
    FileCopy sSource, sDest
    CopyFile = True
    Exit Function
 
CopyFile_Error:
    If Err.Number = 0 Then
    ElseIf Err.Number = 70 Then
        MsgBox "The file is currently in use and therfore is locked and cannot be copied at this" & _
               " time.  Please ensure that no one is using the file and try again.", vbOKOnly, _
               "File Currently in Use"
    ElseIf Err.Number = 53 Then
        MsgBox "The Source File '" & sSource & "' could not be found.  Please validate the" & _
               " location and name of the specifed Source File and try again", vbOKOnly, _
               "File Currently in Use"
    Else
        MsgBox "MS Access has generated the following error" & vbCrLf & vbCrLf & "Error Number: " & _
               Err.Number & vbCrLf & "Error Source: CopyFile" & vbCrLf & _
               "Error Description: " & Err.Description, vbCritical, "An Error has Occurred!"
    End If
    Exit Function
End Function
----
link:https://www.devhut.net/2010/09/29/ms-access-vba-copy-a-file/[https://www.devhut.net/2010/09/29/ms-access-vba-copy-a-file/, window='_blank']


=== Hide second column in Combo box

In Visual Basic, the ColumnWidth property setting is an Integer value that represents the column width in twips. You can specify a width or use one of the following predefined settings.

NOTE: When you use a `0` as a ColumnWidth, that columns is not available  in vba.

.Special Column Width Values
[cols="1,8", options='header']
|===
|Setting	|Description
|0	|Hides the column.
|1	|(Default) Sizes the column to the default width.
|===

The Alternative method which allows the column to be used is setting the first columns width to something like `5"`



=== Refresh Subform with new QueryDef SQL

You can't requery, you have to refresh the subform source object:
----
MySubformControl.SourceObject = ""
MySubformControl.SourceObject = "Query.MyQuery"
----

=== Convert expression to data type ( C )

The function name determines the return type as shown in the following:

.Cast and Convert
[source,javascript]
----
-- CAST Syntax:  
CAST ( expression AS data_type [ ( length ) ] )  
  
-- CONVERT Syntax:  
CONVERT ( data_type [ ( length ) ] , expression [ , style ] )  
----

=== Replace

The REPLACE() function replaces all occurrences of a substring within a string, with a new substring.

NOTE: The search is case-insensitive.

TIP: Also look at the STUFF() function.

.Replace
[source,javascript]
----
REPLACE(string, old_string, new_string)
----

Source: 

=== SQL LIKE 
The LIKE operator is used in a WHERE clause to search for a specified pattern in a column.

There are two wildcards often used in conjunction with the LIKE operator:

% - The percent sign represents zero, one, or multiple characters

_ - The underscore represents a single character

NOTE: MS Access uses an asterisk (\*) instead of the percent sign (%), and a question mark (?) instead of the underscore (_).

=== SQL LIKE with Underscore

.Like UNderscore
[source,javascript]
----
... LIKE '%[_]d'
----

Source: link:https://stackoverflow.com/questions/5821/sql-server-escape-an-underscore[https://stackoverflow.com/questions/5821/sql-server-escape-an-underscore, window='_blank'/



=== Create Table 
- By Copying all columns from another table
Syntax
The syntax for the CREATE TABLE AS statement when copying all of the columns in SQL is:

.Create Table Select
[source,javascript]
----
CREATE TABLE new_table
  AS (SELECT * FROM old_table);
----

Source: link:https://www.techonthenet.com/sql/tables/create_table2.php[https://www.techonthenet.com/sql/tables/create_table2.php, window='_blank']


=== C data conversion

[cols="2,2,8", options='header']
|===
|Function |Return Type |Range for expression argument
|CBool|Boolean|Any valid string or numeric expression.
|CByte|Byte|0 to 255.
|CCur|Currency|-922,337,203,685,477.5808 to 922,337,203,685,477.5807.
|CDate|Date|Any valid date expression.
|CDbl|Double|-1.79769313486231E308 to-4.94065645841247E-324 for negative values; 4.94065645841247E-324 to 1.79769313486232E308 for positive values.
|CDec|Decimal|+/-79,228,162,514,264,337,593,543,950,335 for zero-scaled numbers, that is, 
numbers with no decimal places. For numbers with 28 decimal places, the range is
+/-7.9228162514264337593543950335. The smallest possible non-zero number is 0.0000000000000000000000000001.
|CInt|Integer|-32,768 to 32,767; fractions are rounded.
|CLng|Long|-2,147,483,648 to 2,147,483,647; fractions are rounded.
|CSng|Single|-3.402823E38 to -1.401298E-45 for negative values; 1.401298E-45 to 3.402823E38 for positive values.
|CStr|String|Returns for CStr depend on the expression argument.
|CVar|Variant|Same range as Double for numerics. Same range as String for non-numerics.
|===

=== Creating User Properties (Tables / Queries)

You can create user-defined properties for persistent DAO objects, 
such as tables and queries. You can't create properties for nonpersistent objects, such as recordsets. 
To create a user-defined property, you must first create the property, 
using the Database's CreateProperty method. 
You then append the property using the Properties collection's Append method. That's all there is to it.

Using the example of a field's Description property, the following code demonstrates just how easy it is:

----
Public Sub SetFieldDescription(strTableName As String, _
    strFieldName As String, _
    varValue As Variant, _
)
    Dim dbs As DAO.Database
    Dim prop As DAO.Property
    Set dbs = CurrentDb

    'Create the property
    Set prop = dbs.CreateProperty("Description", dbText, varValue)

    'Append the property to the object Properties collection
    dbs(strTableName)(strFieldName).Properties.Append prop
    Debug.Print dbs(strTableName)(strFieldName).Properties("Description")

    'Clean up
    Set prop = Nothing
    Set dbs = Nothing
End Sub
----

link:https://sourcedaddy.com/ms-access/setting-and-retrieving-built-in-object-properties.html[https://sourcedaddy.com/ms-access/setting-and-retrieving-built-in-object-properties.html, window='_blank']

=== Turn off datasheet Sort/Filter

On design view go to the properties page. Under the "Other" or "All" tab find Shortcut Menu. 
Change that property from Yes to No and save. 
Be warned though that this will disable all shortcuts for the form and not just the drop down filter/sort menus on column headings in datasheet view.

=== Determine the Current Object

The CurrentObjectName property is set by Microsoft Access to a string expression containing the name of the active object.

.Current Object
[source,javascript]
----
 intCurrentType = Application.CurrentObjectType 
 strCurrentName = Application.CurrentObjectName 
----

=== Update LastUpdated and UpdatedBy

These two fields are used in most my code to show when the row was last touched by someone.

.Update Audit
[source,javascript]
----
Private Sub Form_BeforeUpdate(Cancel As Integer)
    '\*--- TimeStanp any change
    Me.LastUpdated = Now()
    Me.UpdatedBy = SetUserName()
End Sub
----



=== Determine Current subroutine

.Current sub
[source,javascript]
----
    msgbox  Application.VBE.ActiveCodePane.CodeModule)
    '*--- will return something like 
    '* Form_frmIMMTemplateImport
----




=== Requery a form from another form


----
e.dirty = false
Forms!frmLegacy.Requery
----

Source: http://www.utteraccess.com/forum/Requery-Form-Form-t2001669.html


=== Relinking table VBA

.Relink Tables
[source,vbscript,linenums]
----
Function ReLinkTable(strTable As String, strPath As String) As Boolean
  ' Comments: Re-links the named table to the named path
  ' Params  : strTable     Table name of the linked table
  ' strPath : full path name of the database containing the real table
  ' Returns : True if successful, False otherwise
  
  Dim fOK As Boolean
  Dim dbs As DAO.Database
  Dim tdf As DAO.TableDef
  Dim strPrefix As String
  Dim strNewConnect As String

  fOK = False
  
  On Error GoTo PROC_ERR

  Set dbs = CurrentDb() 
  Set tdf = dbs.TableDefs(strTable)
 
  strPrefix = Left$(tdf.Connect, InStr(tdf.Connect, "="))
  strNewConnect = strPrefix & strPath

  tdf.Connect = strNewConnect
  tdf.RefreshLink

  fOK = True

PROC_EXIT:
  dbs.Close
  ReLinkTable = fOK
  Exit Function

PROC_ERR:
  Resume PROC_EXIT
End Function
----

link:http://www.fmsinc.com/microsoftaccess/databasesplitter/[http://www.fmsinc.com/microsoftaccess/databasesplitter/, window='_blank']



=== Hidden properties of datasheet

The properties in Access related to datasheet.

[cols="3,8", options='header']
.Hidden Properties
|===
|Property | Meaning and Usage
|ColumnHidden	|Exists on columns in the datasheet, controls whether the column is visible or not.
|ColumnWidth	|Exists on columns in the datasheet, controls the width of the column.
|DatasheetBackColor	|Exists on the datasheet itself, specifies the background color for the whole datasheet.
|DatasheetCellsEffect	|Exists on the datasheet itself, handles whether special effects are used for the cells (flat, raised, or sunken are the only effects supported).
|DatasheetFontHeight	|Exists on the datasheet itself, this unfortunately named property specifies the font size.
|DatasheetFontItalic	|Exists on the datasheet itself, controls whether all of the text is italic.
|DatasheetFontName	|Exists on the datasheet itself, controls the name of the font.
|DatasheetFontUnderline	|Exists on the datasheet itself, controls whether all of the text is underlined.
|DatasheetFontWeight	|Exists on the datasheet itself, controls whether the text is bolded.
|DatasheetForeColor	|Exists on the datasheet itself, specifies the foreground color for the whole datasheet.
|DatasheetGridlinesBehavior	|Exists on the datasheet itself, controls which gridlines will be displayed (if any).
|DatasheetGridlinesColor	|Exists on the datasheet itself, specifies the color of the gridlines.
|FrozenColumns	|Exists on the datasheet itself, specifies how many columns have been frozen by the user (discussed later in the article).
|ShowGrid	|Exists on the datasheet itself, but has been superseded by the DatasheetGridlinesBehavior property.
|SubdatasheetExpanded	|Exists on the datasheet itself, specifies whether all subdatasheets should be expanded. (Access 2000 only)
|SubdatasheetHeight	|Exists on the datasheet itself, specifies the number of records to display for subdatasheets (a scrollbar appears if there are more records than this property allows). (Access 2000 only)
|SubdatasheetName	|Exists on the datasheet itself, specifies the name of the table's subdatasheet. (Access 2000 only)
|TabularCharSet	|Exists on the datasheet itself, and is hidden. It specifies the font character set and can often cause bad things to happen if it's set to an incorrect value. It's best not to set it, or to set it to 1 (which uses the DEFAULT_CHARSET for the machine).
|===

With the exception of the Subdatasheet properties, 
you have no direct design-time access to these properties: 
None of these properties show up in the datasheet property sheet.
As a result, they can only be set at runtime from VBA code in order to make changes. 
Interestingly, none of the properties are exposed by ADO or ADOX, so if you want to change them, 
you'll have to use DAO.

While you can't access these properties through property sheets, many of them can be set in the user interface. 
They are, for example, what's changed when you set the font of a datasheet from the Format menu. 
For full control over the datasheet, though, 
you'll want to explicitly set the properties in code and save the object when you're done.

It's worth noting that a datasheet is a form�it says so right in the object browser. 
The object browser considers the datasheet columns to be the controls on the form. 
As a result, a datasheet can consist of any control that can be displayed, 
which means all TextBox, ComboBox, and CheckBox controls.

Source: https://docs.microsoft.com/en-us/previous-versions/office/developer/office-2003/aa217449(v=office.11)?redirectedfrom=MSDN

=== Change Hide / Show of a field on datasheet

The code to show and hide the columns is in a routine called ShowHideColumn. 

----
Private Function ShowHideColumn()
    Dim sfrm As SubForm
    Dim ctl As Control
    Dim stCtl As String
    
    Set sfrm = Me.sfrmHideShowColumns
    For Each ctl In Me.Controls
        If TypeOf ctl Is Access.CheckBox Then
            stCtl = "tb" & Mid$(ctl.Name, 3)
            sfrm.Form(stCtl).ColumnHidden = _
                       Not ctl.Value
        End If
    Next ctl
End Function
----


=== Select Case (If-Then-Else)

The Microsoft Access Case statement can only be used in VBA code. It has the functionality of an IF-THEN-ELSE statement.

----
Select Case test_expression

   Case condition_1
      result_1
   Case condition_2
      result_2
   ...
   Case condition_n
      result_n

 [ Case Else
      result_else ]

End Select
----

Source: https://www.techonthenet.com/access/functions/advanced/case.php


=== Access columns of Combo control

Use 0 to refer to the first column, 1 to refer to the second column, 
and so on. Use 0 to refer to the first row, 1 to refer to the second row, 
and so on. For example, 
in a list box containing a column of customer IDs and a column of customer names, 
you could refer to the customer name in the second column (1) and fifth (4) row as:

If the user has made no selection when you refer to a column in a combo box or list box, 
the Column property setting will be Null. 
You can use the IsNull function to determine if a selection has been made

----
Forms!Contacts!Customers.Column(1, 4)

'*--- Empty combo selection
If IsNull(Forms!Customers!Country) 
  Then MsgBox "No selection." 
End If
----

=== Set Filter on Subform from Main Form

----
'*--- lstBoxSheets is the subForm
Me.LstBoxSheets.Form.Filter = "prjCategory='General'"
Me.LstBoxSheets.Form.FilterOn = True
----


=== Reset query Column Order setting 

So, when you open a query in Datasheet view, and the column order has not been messed with and saved, 
the column order displayed is determined by the OrdinalPosition and the value of that property corresponds 
to the order in which your columns appear in the query design grid (OrdinalPosition is 0 based, so 0 
is the first column).

Then ... when you move the column while viewing the query in Datasheet view, and subsequently 
save that change in the column order, Access creates the ColumnOrder property for each of the columns in the query. 
This property is not visible in the query design grid, but is definately there.

----
Public Sub ResetColumnOrder(strQueryName)
    Dim fld As DAO.Field
    Dim qdf As DAO.QueryDef
    
    Set qdf = CurrentDb.QueryDefs(strQueryName)
    
    For Each fld In qdf.Fields
        On Error Resume Next
        fld.Properties.Delete "ColumnOrder"
    Next fld
        
End Sub
----


=== Open Dynaset, change SQL

=== Open recordset, add row

----
Dim dbCurrent As Database
Dim rsNotes As Recordset
Dim sSQL As String

    sSQL = "Select * from PrePos where PostType = 'Help';"
    Set dbCurrent = CurrentDb
    Set rsNotes = dbCurrent.OpenRecordset(sSQL, dbOpenDynaset, dbSeeChanges)
    With rsNotes
        If .EOF Then
            .AddNew
            ![PostIMMTable] = gsNewTableName
            ![PostIMMField] = gsNewFieldName
            ![PostPtype] = gsPtype
            ![Notes] = Me.txtNotes
            ![UpdatedDate] = Now()
            ![UpdatedBy] = gsUserName
            .Update
            .Close
        End If
    End With
    Set rsNotes = Nothing
    Set dbCurrent = Nothing   
----        

=== Select Cased Statement (VBA)

----
Select Case test_expression

   Case condition_1
      result_1
   Case condition_2
      result_2
   ...
   Case condition_n
      result_n

 [ Case Else
      result_else ]

End Select
----

=== Coalesce Function

Access does not have Coalesce function, this quick VBA equivalent.
You pass it an array of values.

.Coalesce Function
[source,javascript]
----
Function Coalesce(ParamArray varValues()) As Variant
'returns the first non null value, similar to SQL Server Coalesce() function
'Patrick Honorez --- www.idevlop.com
    Dim i As Long
    Coalesce = Null
    For i = LBound(varValues) To UBound(varValues)
        If Not IsNull(varValues(i)) Then
            Coalesce = varValues(i)
            Exit Function
        End If
    Next
End Function
----

link:https://stackoverflow.com/questions/247858/coalesce-alternative-in-access-sql[https://stackoverflow.com/questions/247858/coalesce-alternative-in-access-sql, window='_blank']

=== IsNull

The MS Access IsNull() function returns TRUE (-1) if the expression is a null value, otherwise FALSE (0):

.IsNull
[source,javascript]
----
SELECT ProductName, UnitPrice * (UnitsInStock + IIF(IsNull(UnitsOnOrder), 0, UnitsOnOrder))
FROM Products;
----

Source: link:https://www.w3schools.com/sql/sql_isnull.asp[https://www.w3schools.com/sql/sql_isnull.asp, window='_blank']


=== Print

.Print
[source,javascript]
----
PRINT msg_str | @local_variable | string_expr  
----

msg_str
Is a character string or Unicode string constant. For more information, see Constants (Transact-SQL).

@ local_variable
Is a variable of any valid character data type. @local_variable must be char, nchar, varchar, or nvarchar, or it must be able to be implicitly converted to those data types.

string_expr
Is an expression that returns a string. Can include concatenated literal values, functions, and variables. For more information, see Expressions (Transact-SQL).

NOTE: Print can not be used in Functions

=== List Columns (Schema)


.List Columns
[source,javascript]
----
select schema_name(tab.schema_id) as schema_name,
    tab.name as table_name, 
    col.column_id,
    col.name as column_name, 
    t.name as data_type,    
    col.max_length,
    col.precision
from sys.tables as tab
    inner join sys.columns as col
        on tab.object_id = col.object_id
    left join sys.types as t
    on col.user_type_id = t.user_type_id
order by schema_name,
    table_name, 
    column_id;
----


Source: link:https://dataedo.com/kb/query/sql-server/list-table-columns-in-database[https://dataedo.com/kb/query/sql-server/list-table-columns-in-database, window='_blank']

.List Columns (More Detail)
[source,javascript]
----
SELECT
     SysTbls.name AS [Table Name]
    ,SysCols.name AS [Column Name]
    ,ExtProp.value AS [Extended Property]
    ,Systyp.name AS [Data Type]
    ,CASE WHEN Systyp.name IN('nvarchar','nchar')
               THEN (SysCols.max_length / 2)
          WHEN Systyp.name IN('char')
               THEN SysCols.max_length
          ELSE NULL
          END AS 'Length of Column'
    ,CASE WHEN SysCols.is_nullable = 0
               THEN 'No'
          WHEN SysCols.is_nullable = 1
               THEN 'Yes'
          ELSE NULL
          END AS 'Column is Nullable'  
    ,SysObj.create_date AS [Table Create Date]
    ,SysObj.modify_date AS [Table Modify Date]
FROM sys.tables AS SysTbls
   LEFT JOIN sys.extended_properties AS ExtProp
         ON ExtProp.major_id = SysTbls.[object_id]
   LEFT JOIN sys.columns AS SysCols
         ON ExtProp.major_id = SysCols.[object_id]
         AND ExtProp.minor_id = SysCols.column_id
   LEFT JOIN sys.objects as SysObj
         ON SysTbls.[object_id] = SysObj.[object_id]
   INNER JOIN sys.types AS SysTyp
         ON SysCols.user_type_id = SysTyp.user_type_id
WHERE class = 1 --Object or column
  AND SysTbls.name IS NOT NULL
  AND SysCols.name IS NOT NULL
----










== MySQL

=== Like with Join

----
SELECT table1.\*, table2.z
FROM table1
INNER JOIN table2
  ON table2.name LIKE CONCAT('%', table1.name, '%') 
 AND table1.year = table2.year
----

=== Update with Where

----
UPDATE table_name
SET column1 = value1, column2 = value2, ...
WHERE condition;
----

=== Update with Join

----
UPDATE T1, T2,
[INNER JOIN | LEFT JOIN] T1 ON T1.C1 = T2. C1
SET T1.C2 = T2.C2, 
    T2.C3 = expr
WHERE condition
----



link:https://www.mysqltutorial.org/mysql-update-join/[https://www.mysqltutorial.org/mysql-update-join/, window='_blank']



=== Count Distinct

You can use the DISTINCT clause within the COUNT function. For example, 
the SQL statement below returns the number of unique departments where at least one employee makes over $55,000 / year.

----
SELECT COUNT(DISTINCT department) AS "Unique departments"
FROM employees
WHERE salary > 55000;
----

=== Count nulls

----
select sum(case when FirstName IS NULL then 1 else 0 end) as NUMBER_OF_NULL_VALUE from DemoTable;
----

Source: https://www.tutorialspoint.com/how-to-count-null-values-in-mysql

=== Add a Auto Increment column to a table

.Add Auto Increment
[source,javascript]
----
ALTER TABLE ThreeSeasons ADD column id INT NOT NULL AUTO_INCREMENT unique first
----

=== Case (Select)

The CASE statement goes through conditions and return a value when the first condition is met (like an IF-THEN-ELSE statement). 
So, once a condition is true, it will stop reading and return the result.

If no conditions are true, it will return the value in the ELSE clause.

If there is no ELSE part and no conditions are true, it returns NULL.

.Case
[source,basic]
----
SELECT OrderID, Quantity,
CASE
    WHEN Quantity > 30 THEN "The quantity is greater than 30"
    WHEN Quantity = 30 THEN "The quantity is 30"
    ELSE "The quantity is under 30"
END
FROM OrderDetails;
----

=== DBA Display all columns of Tables in DB

.MySQL Column List
[source,javascript]
----
select 
    tab.name as table_name, 
    col.column_id,
    col.name as column_name, 
    t.name as data_type,    
    col.max_length,
    col.precision
from sys.tables as tab
    inner join sys.columns as col
        on tab.object_id = col.object_id
    left join sys.types as t
    on col.user_type_id = t.user_type_id
----




== SQL Server

=== Concat

----
CONCAT(string1, string2, ...., string_n)
----

=== Cast Number into string

----
CAST(expression AS datatype(length))
----

.Parameter Values
|===
|Value	|Description
|expression	|Required. The value to convert
|datatype	|Required. The datatype to convert expression to. Can be one of the following: bigint, int, smallint, tinyint, bit, decimal, numeric, money, smallmoney, float, real, datetime, smalldatetime, char, varchar, text, nchar, nvarchar, ntext, binary, varbinary, or image
|(Length)	|Optional. The length of the resulting data type (for char, varchar, nchar, nvarchar, binary and varbinary)
Technical Details
|===

=== Round
.Round
[source,javascript]
----
ROUND(number, decimals, operation)

-- Round number to nearest decimal 
round(DIHTA.ValueIS, 0, 1)
----

.Round arguments
[cols='1,8' options='header']
|===
|Parameter	|Description
|number	|Required. The number to be rounded
|decimals	|Required. The number of decimal places to round number to
|operation	|Optional. If 0, it rounds the result to the number of decimal. If another value than 0, it truncates the result to the number of decimals. Default value is 0
|===


=== Find string within a string

----
SELECT CHARINDEX('t', 'Customer') AS MatchPosition;
----

=== Create Table Select (Copy Table)

The SELECT INTO statement copies data from one table into a new table.

----
SELECT *
INTO newtable [IN externaldb]
FROM oldtable
WHERE condition;
----

Practical Example

----
select distinct FieldName 
	into New_DealPathway_B2    
from dbo.Pre_Migration_Guide
----


=== IF then else

----
IF Boolean_expression   
     { sql_statement | statement_block }   
[ ELSE   
     { sql_statement | statement_block } ]   
----

=== Immediate If (IIF)

----
IIF(condition, value_if_true, value_if_false)
----

=== Variables

----
-- Declare a variable with a data type
DECLARE @model_year SMALLINT;

-- Set a variable to a value
SET @model_year = 2018;

-- Use variable in query
SELECT
    product_name,
    model_year,
    list_price 
FROM 
    production.products
WHERE 
    model_year = @model_year
ORDER BY
    product_name;
    
-- Set Variable in query    
SELECT 
    @product_name = product_name,
    @list_price = list_price
FROM
    production.products
WHERE
    product_id = 100;    
    
----



=== Substring (Substr)
----
SUBSTRING(string, start, length)

-- Example
SELECT 
    email, 
    SUBSTRING(
        email, 
        CHARINDEX('@', email)+1, 
        LEN(email)-CHARINDEX('@', email)
    ) domain
FROM 
    sales.customers
ORDER BY 
    email;
----

=== Update with a Join

----
UPDATE 
    t1
SET 
    t1.c1 = t2.c2,
    t1.c2 = expression,
    ...   
FROM 
    t1
    [INNER | LEFT] JOIN t2 ON join_predicate
WHERE 
    where_predicate;
----

=== Charindex (InStr)

----
SELECT 
    email, 
    SUBSTRING(
        email, 
        CHARINDEX('@', email)+1, 
        LEN(email)-CHARINDEX('@', email)
    ) domain
FROM 
    sales.customers
ORDER BY 
    email;
----

=== Len (Length) of string

----
SELECT 
    email, 
    SUBSTRING(
        email, 
        CHARINDEX('@', email)+1, 
        LEN(email)-CHARINDEX('@', email)
    ) domain
FROM 
    sales.customers
ORDER BY 
    email;
----

=== Copy Table

The SELECT INTO statement copies data from one table into a new table.

----
SELECT *
INTO newtable [IN externaldb]
FROM oldtable
WHERE condition;
----

Source: https://www.w3schools.com/sql/sql_select_into.asp

link:https://www.w3schools.com/sql/sql_select_into.asp[https://www.w3schools.com/sql/sql_select_into.asp, window='_blank']


=== Parameters in SP

Create a  query torepeatedly to get the data for different sales people, 
you could instead parameterize the query and turn it into a stored procedure like:

----
create procedure getSalesperson
@sp varchar(25)
as
select SalesPerson, Mon, amount
from SalesData
where SalesPerson = @sp;
Go

-- Run the SP
declare @sp varchar(25)
set @sp = 'Jack'
exec getSalesperson @sp
----

link:https://www.mssqltips.com/sqlservertip/2981/using-parameters-for-sql-server-queries-and-stored-procedures/[https://www.mssqltips.com/sqlservertip/2981/using-parameters-for-sql-server-queries-and-stored-procedures/, window='_blank']


=== CharIndex (Substring)

The CHARINDEX() function searches for a substring in a string, and returns the position. If the substring is not found, this function returns 0. Note: This function performs a case-insensitive search.

.CharIndex
[source,javascript]
----
CHARINDEX(substring, string, start)
----

Source: link:https://www.w3schools.com/sql/func_sqlserver_charindex.asp[https://www.w3schools.com/sql/func_sqlserver_charindex.asp, window='_blank']

=== Declare (Variables)

In SQL Server (Transact-SQL), a variable allows a programmer to store data temporarily during the execution of code.

.Declare Variable
[source,javascript]
----
-- Declare the variable to be used.
DECLARE @MyCounter int;

-- Initialize the variable.
SET @MyCounter = 0;

-- Alternative example
DECLARE @techonthenet VARCHAR(50);

SET @techonthenet = 'Example showing how to declare variable';
----

=== Case then

The CASE statement goes through conditions and returns a value when the first condition is met (like an IF-THEN-ELSE statement). So, once a condition is true, it will stop reading and return the result. If no conditions are true, it returns the value in the ELSE clause.

.Case then
[source,javascript]
----
CASE expression
   WHEN value_1 THEN result_1
   WHEN value_2 THEN result_2
   WHEN value_n THEN result_n
   ELSE result
END

-- Or

CASE
   WHEN condition_1 THEN result_1
   WHEN condition_2 THEN result_2
   WHEN condition_n THEN result_n
   ELSE result
END
----

Source: link:https://www.w3schools.com/sql/sql_case.asp[https://www.w3schools.com/sql/sql_case.asp, window='_blank']

Source: link:https://www.techonthenet.com/sql_server/functions/case.php[https://www.techonthenet.com/sql_server/functions/case.php, window='_blank']

=== Adding columns with Nulls

When you add a null to a total the total becomes null.  Change Nulls into zero

.Adding Nulls
[source,bash]
----
-- Method 1 SQL Server specific
isnull(P01,0)

-- Method 2  ANSI Standard
COALESCE(P01,0)
----

Source: link:https://stackoverflow.com/questions/1088648/sql-sum-3-columns-when-one-column-has-a-null-value[https://stackoverflow.com/questions/1088648/sql-sum-3-columns-when-one-column-has-a-null-value, window='_blank']


=== Line Continuation (Backslash)

.Continuation
[source,javascript]
----
<first section of string> \  
<continued section of string>
----

Source: link:https://docs.microsoft.com/en-us/sql/t-sql/language-elements/sql-server-utilities-statements-backslash?view=sql-server-ver15[https://docs.microsoft.com/en-us/sql/t-sql/language-elements/sql-server-utilities-statements-backslash?view=sql-server-ver15, window='_blank']


=== Merge (UpSert)

Lets create a MERGE statement to INSERT or UPDATE a row in table ClientData:

.Merge
[source,javascript]
----

MERGE dbo.ClientData AS [Target]
USING (SELECT 12345 AS clientId) AS [Source] 
ON [Target].clientId = [Source].clientId
WHEN MATCHED THEN
  UPDATE SET [Target].data='Update', [Target].updatedDateUtc = GetUtcDate()
WHEN NOT MATCHED THEN
  INSERT (clientId, data) VALUES ([Source].clientId, 'Insert');
----

Source: link:https://myadventuresincoding.wordpress.com/2016/01/05/sql-server-how-to-write-an-upsert-using-merge/[https://myadventuresincoding.wordpress.com/2016/01/05/sql-server-how-to-write-an-upsert-using-merge/, window='_blank']




== SQLite

=== DSNLess ODBC connection

----
DRIVER=SQLite3 ODBC Driver;Database=c:\mydb.db;LongNames=0;Timeout=1000;NoTXN=0;SyncPragma=NORMAL;StepAPI=0;

-- Zortero Example
ODBC;DSN=Zotero;Database=C:\Users\{userDirectory}\Zotero\link_zotero.sqlite;StepAPI=0;SyncPragma=OFF;NoTXN=0;Timeout=;ShortNames=0;LongNames=0;NoCreat=0;NoWCHAR=0;FKSupport=0;JournalMode=;OEMCP=0;LoadExt=;BigInt=0;JDConv=0;;TABLE=collections
----

This is some VB code to create the DSNLess Connection

.DSNLess VB Code
[source,javascript]
----
'//Name     :   AttachDSNLessTable
'//Purpose  :   Create a linked table to SQL Server without using a DSN
'//Parameters
'//     stLocalTableName: Name of the table that you are creating in the current database
'//     stRemoteTableName: Name of the table that you are linking to on the SQL Server database
'//     stServer: Name of the SQL Server that you are linking to
'//     stDatabase: Name of the SQL Server database that you are linking to
'//     stUsername: Name of the SQL Server user who can connect to SQL Server, leave blank to use a Trusted Connection
'//     stPassword: SQL Server user password
Function AttachDSNLessTable(stLocalTableName As String, stRemoteTableName As String, stServer As String, stDatabase As String, Optional stUsername As String, Optional stPassword As String)
    On Error GoTo AttachDSNLessTable_Err
    Dim td As TableDef
    Dim stConnect As String

For Each td In CurrentDb.TableDefs
        If td.Name = stLocalTableName Then
            CurrentDb.TableDefs.Delete stLocalTableName
        End If
    Next

If Len(stUsername) = 0 Then
        '//Use trusted authentication if stUsername is not supplied.
        stConnect = "ODBC;DRIVER=SQL Server;SERVER=" & stServer & ";DATABASE=" & stDatabase & ";Trusted_Connection=Yes"
    Else
        '//WARNING: This will save the username and the password with the linked table information.
        stConnect = "ODBC;DRIVER=SQL Server;SERVER=" & stServer & ";DATABASE=" & stDatabase & ";UID=" & stUsername & ";PWD=" & stPassword
    End If
    Set td = CurrentDb.CreateTableDef(stLocalTableName, dbAttachSavePWD, stRemoteTableName, stConnect)
    CurrentDb.TableDefs.Append td
    AttachDSNLessTable = True
    Exit Function

AttachDSNLessTable_Err:

AttachDSNLessTable = False
    MsgBox "AttachDSNLessTable encountered an unexpected error: " & Err.Description

End Function
----

link:https://docs.microsoft.com/en-us/office/troubleshoot/access/create-dsn-less-connection-linkted-table[https://docs.microsoft.com/en-us/office/troubleshoot/access/create-dsn-less-connection-linkted-table, window='_blank']


=== Get last ID of a table

.Last Record
[source,javascript]
----
Dim lastID As Integer
lastID = DMax("IDField","YourTable")
----



=== Copy Text Box to Clipboard

The following example illustrates how to copy the contents of a text box named txtNotes to the Clipboard.
.Copy to Clipboard
[source,javascript]
----
Private Sub cmdCopy_Click() 
   Me!txtNotes.SetFocus 
   DoCmd.RunCommand acCmdCopy 
End Sub
----

link:https://docs.microsoft.com/en-us/office/vba/access/concepts/windows-api/send-information-to-the-clipboard[https://docs.microsoft.com/en-us/office/vba/access/concepts/windows-api/send-information-to-the-clipboard, window='_blank']




== Powershell

=== Extract x Top rows of text file

----
get-content input.txt|select-object -first 10 >output.txt
----

link:https://stackoverflow.com/questions/28908638/extract-only-the-first-10-lines-of-a-csv-file-in-powershell[https://stackoverflow.com/questions/28908638/extract-only-the-first-10-lines-of-a-csv-file-in-powershell, window='_blank']


<<<<
== Document History

.Document History
[cols='2,2,2,6' options='header']
|===
| Date  | Version | Author | Description
| 06/14/2020 | V2.1d | JHRS |Charindex, isnull, Variables
| 06/08/2020 | V2.1c | JHRS | added MySQL DBVA
| 06/04/2020 | V2.1b | JHRS |  Initial version
|===

